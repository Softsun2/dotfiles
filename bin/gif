#!/bin/bash

INPUT_INDEX="$(($# - 1))"
OUTPUT_INDEX="$#"

INPUT="${!INPUT_INDEX}"
OUTPUT="${!OUTPUT_INDEX}"
FILTERS=""
SPEED=""

usage() {
  echo "Usage: $0 [-r <int>] [-a <int:int>] [-s <float>] input-file output-file" 1>&2; exit 1;
}

if [ "$#" -gt 1 ]
then

  while getopts "r:a:s:" o ; do
    case "$o" in
      r) RATE="-r $OPTARG" ;;
      a) test -z "$FILTERS" && FILTERS="scale=$OPTARG" || FILTERS+=", scale=$OPTARG" ;;
      s) test -z "$FILTERS" && FILTERS="setpts=$OPTARG*PTS" || FILTERS+=", setpts=$OPTARG*PTS" ;;
    esac
  done

  test -z "$FILTERS" &&
    ffmpeg -i $INPUT $RATE -f gif $OUTPUT ||
    ffmpeg -i $INPUT $RATE -vf "''$FILTERS''" -f gif $OUTPUT
    # I don't understand why i have to double quote the filter lmao
else
  usage
fi
